<div class="space-y-3 p-4 bg-white rounded-xl border border-gray-200">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm font-semibold text-gray-800">Equipos</p>
      <p class="text-xs text-gray-500">
        Elige un equipo o crea uno nuevo para esta actividad.
      </p>
    </div>
    @if (canCreateEquipos) {
    <button
      type="button"
      (click)="toggleCrearEquipo()"
      class="px-3 py-2 rounded-lg text-sm font-semibold border border-blue-300 text-blue-700 hover:bg-blue-50 transition-colors"
    >
      {{ mostrarCrearEquipo ? "Cancelar" : "Crear equipo" }}
    </button>
    }
  </div>

  @if (cargandoEquipos) {
  <p class="text-sm text-gray-600">Cargando equipos...</p>
  } @else if (equipos && equipos.length > 0) {
  <div class="space-y-2">
    @for (equipo of equipos; track equipo.idEquipo) {
    <label
      class="flex items-center gap-3 p-3 rounded-lg border border-gray-200 hover:border-blue-300 cursor-pointer transition-colors"
    >
      <input
        type="radio"
        [value]="equipo.idEquipo"
        [(ngModel)]="selectedEquipoId"
        (ngModelChange)="onEquipoSeleccionado(equipo.idEquipo)"
        name="equipoSeleccionado"
        class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
        [disabled]="mostrarCrearEquipo"
      />
      <div class="flex-1">
        <p class="text-sm font-semibold text-gray-800">
          {{ equipo.nombreEquipo }}
        </p>
        <p class="text-xs text-gray-500 flex items-center gap-2">
          <span>Equipo #{{ equipo.idEquipo }}</span>
          <span class="text-gray-300">•</span>
          @if (getEquipoColorSwatch(getEquipoColorNombre(equipo.idColor))) {
          <span
            class="inline-block w-2.5 h-2.5 rounded-full border border-gray-200"
            [style.backgroundColor]="
              getEquipoColorSwatch(getEquipoColorNombre(equipo.idColor))
            "
          ></span>
          }
          <span>Color: {{ getEquipoColorNombre(equipo.idColor) }}</span>
        </p>
      </div>
    </label>
    }
  </div>

  @if (selectedEquipoId) {
  <div class="mt-3 p-3 rounded-lg border border-gray-200 bg-white">
    <p class="text-sm font-semibold text-gray-800">
      Jugadores del equipo #{{ selectedEquipoId }}
    </p>

    @if (cargandoJugadores) {
    <p class="text-sm text-gray-600 mt-2">Cargando jugadores...</p>
    } @else if (jugadoresEquipo && jugadoresEquipo.length > 0) {
    <div class="mt-2 space-y-2">
      @for (j of jugadoresEquipo; track j.idMiembroEquipo) {
      <div
        class="flex items-center gap-3 p-2 rounded-lg border border-gray-100"
      >
        <div
          class="w-9 h-9 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center"
        >
          @if (j.imagen) {
          <img
            [src]="j.imagen"
            class="w-full h-full object-cover"
            alt="avatar"
          />
          } @else {
          <span class="text-xs text-gray-500">IMG</span>
          }
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-semibold text-gray-800 truncate">
            {{ j.usuario }}
          </p>
          <p class="text-xs text-gray-500 truncate">{{ j.curso }}</p>
        </div>
        <div class="text-xs text-gray-500">
          {{ j.role }}
        </div>
      </div>
      }
    </div>
    } @else {
    <p class="text-sm text-gray-600 mt-2">No hay jugadores en este equipo.</p>
    }
  </div>
  } } @else {
  <p class="text-sm text-gray-600">No hay equipos todavía.</p>
  @if (!canCreateEquipos) {
  <p class="text-xs text-gray-500">
    Habla con el capitán de esta actividad para que cree un equipo.
  </p>
  } @else {
  <p class="text-xs text-gray-500">
    Puedes crear un equipo usando el boton "Crear equipo".
  </p>
  } } @if (mostrarCrearEquipo) {
  <div class="space-y-3 pt-2 border-t border-gray-200">
    <div>
      <label class="block text-sm font-semibold text-gray-800 mb-2"
        >Nombre del equipo</label
      >
      <input
        type="text"
        [(ngModel)]="nuevoEquipoNombre"
        name="nuevoEquipoNombre"
        placeholder="Ej: Equipo A"
        class="block w-full border-2 border-gray-300 rounded-xl px-4 py-3 text-sm font-medium text-gray-700 bg-white shadow-sm focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500"
      />
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-800 mb-2"
        >Color</label
      >
      <select
        [(ngModel)]="nuevoEquipoColorId"
        name="nuevoEquipoColorId"
        class="block w-full border-2 border-gray-300 rounded-xl px-4 py-3 text-sm font-medium text-gray-700 bg-white shadow-sm cursor-pointer transition-all duration-300 ease-in-out hover:border-blue-400 hover:bg-blue-50 focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500"
      >
        <option [ngValue]="null" disabled selected class="text-gray-400 italic">
          -- Elige un color --
        </option>
        @if (cargandoColores) {
        <option [ngValue]="null" disabled>Cargando colores...</option>
        } @else { @for (color of colores; track color.idColor) {
        <option [ngValue]="color.idColor">{{ color.nombreColor }}</option>
        } }
      </select>
    </div>
  </div>
  } @if (showConfirmButton) {
  <div class="pt-2 border-t border-gray-200 flex justify-end">
    <button
      type="button"
      (click)="confirmar()"
      class="bg-green-400 text-black px-4 py-2 rounded hover:bg-green-500 font-semibold text-sm"
    >
      Confirmar equipo
    </button>
  </div>
  }
</div>
